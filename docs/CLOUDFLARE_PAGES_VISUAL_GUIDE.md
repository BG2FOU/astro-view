# Cloudflare Pages éƒ¨ç½²é…ç½®æˆªå›¾æŒ‡å—

## é—®é¢˜åŸå› å›¾è§£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‚¨çš„ä»£ç ï¼ˆé”™è¯¯ï¼‰                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  index.html:                                                â”‚
â”‚  <script>                                                   â”‚
â”‚    window.CONFIG = {                                        â”‚
â”‚      AMAP_API_KEY: process.env.AMAP_API_KEY  âŒ              â”‚
â”‚    };                                                       â”‚
â”‚  </script>                                                  â”‚
â”‚                                                             â”‚
â”‚  é—®é¢˜ï¼š                                                      â”‚
â”‚  1. process æ˜¯ Node.js å¯¹è±¡ï¼Œæµè§ˆå™¨ä¸­ä¸å­˜åœ¨               â”‚
â”‚  2. ç¯å¢ƒå˜é‡åªåœ¨æ„å»ºæ—¶å¯ç”¨ï¼Œè¿è¡Œæ—¶æ— æ³•è®¿é—®              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§£å†³æ–¹æ¡ˆï¼šæ„å»ºæ—¶ç”Ÿæˆï¼Œè¿è¡Œæ—¶ä½¿ç”¨                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ„å»ºæ­¥éª¤ï¼š                                                   â”‚
â”‚  1. Cloudflare Pages è¯»å–ç¯å¢ƒå˜é‡                          â”‚
â”‚  2. è¿è¡Œ npm run build                                      â”‚
â”‚  3. build-config.js è„šæœ¬æ‰§è¡Œï¼š                            â”‚
â”‚     - è¯»å– process.env.AMAP_API_KEY                         â”‚
â”‚     - ç”Ÿæˆ src/config.js æ–‡ä»¶                              â”‚
â”‚  4. index.html åŠ è½½ç”Ÿæˆçš„ src/config.js                    â”‚
â”‚  5. app.js ä½¿ç”¨å…¨å±€çš„ window.CONFIG                         â”‚
â”‚                                                             â”‚
â”‚  ç»“æœï¼šâœ… åœ°å›¾æ­£å¸¸æ˜¾ç¤º                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Cloudflare Pages Dashboard é…ç½®æ­¥éª¤

### æ­¥éª¤ 1ï¸âƒ£: è¿›å…¥ç¯å¢ƒå˜é‡è®¾ç½®

```
Cloudflare Dashboard
  â†“
é€‰æ‹©æ‚¨çš„ Pages é¡¹ç›®
  â†“
Settings (è®¾ç½®)
  â†“
Environment variables (ç¯å¢ƒå˜é‡)
```

### æ­¥éª¤ 2ï¸âƒ£: æ·»åŠ ç”Ÿäº§ç¯å¢ƒå˜é‡

**æ“ä½œæµç¨‹ï¼š**

1. åœ¨ "Production" ç¯å¢ƒä¸‹ï¼Œç‚¹å‡» "Add variable"
2. æ·»åŠ ç¬¬ä¸€ä¸ªå˜é‡ï¼š
   ```
   å˜é‡å: AMAP_API_KEY
   å€¼: (æ‚¨çš„é«˜å¾·åœ°å›¾ API Key)
   ```
3. æ·»åŠ ç¬¬äºŒä¸ªå˜é‡ï¼š
   ```
   å˜é‡å: AMAP_SECURITY_JS_CODE
   å€¼: (æ‚¨çš„å®‰å…¨å¯†é’¥)
   ```

**æˆªå›¾ç¤ºä¾‹ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Environment variables                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Production                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Variable name: AMAP_API_KEY                             â”‚ â”‚
â”‚ â”‚ Value: e5b759a2a9a743ac99a07e48b1dbe23b                â”‚ â”‚
â”‚ â”‚ [Save]                                                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Variable name: AMAP_SECURITY_JS_CODE                   â”‚ â”‚
â”‚ â”‚ Value: f93d8688a469db5a5645503baba74a60                â”‚ â”‚
â”‚ â”‚ [Save]                                                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ [+ Add variable]                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ­¥éª¤ 3ï¸âƒ£: é…ç½®æ„å»ºå‘½ä»¤

```
Cloudflare Dashboard
  â†“
é€‰æ‹©æ‚¨çš„ Pages é¡¹ç›®
  â†“
Settings (è®¾ç½®)
  â†“
Build and deployments (æ„å»ºå’Œéƒ¨ç½²)
```

**å…³é”®è®¾ç½®ï¼š**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Build and deployments                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ Framework preset:        [ æ—  ]  (ä¸æ”¹)                    â”‚
â”‚                                                             â”‚
â”‚ Build command:           [ npm run build ]  (æ”¹è¿™é‡Œï¼)      â”‚
â”‚                                                             â”‚
â”‚ Build output directory:  [ / ]  (ä¸æ”¹)                     â”‚
â”‚                                                             â”‚
â”‚ Root directory:          [ / ]  (ä¸æ”¹)                     â”‚
â”‚                          (Advanced)                         â”‚
â”‚                                                             â”‚
â”‚ [Save]                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ³¨æ„ï¼š**
- Build command æ”¹ä¸º `npm run build`
- å…¶ä»–è®¾ç½®ä¿æŒä¸å˜

### æ­¥éª¤ 4ï¸âƒ£: é‡æ–°éƒ¨ç½²

ä¸¤ç§æ–¹å¼è§¦å‘é‡æ–°éƒ¨ç½²ï¼š

**æ–¹å¼ A - è‡ªåŠ¨éƒ¨ç½²ï¼ˆæ¨èï¼‰ï¼š**
```
1. git add .
2. git commit -m "ä¿®å¤ï¼šé…ç½® Cloudflare Pages æ„å»ºè„šæœ¬"
3. git push origin main
4. â† Cloudflare Pages è‡ªåŠ¨æ£€æµ‹åˆ°æ¨é€
5. â† è‡ªåŠ¨æ‰§è¡Œ npm run build
6. â† è‡ªåŠ¨ç”Ÿæˆ src/config.js
7. â† è‡ªåŠ¨éƒ¨ç½²
```

**æ–¹å¼ B - æ‰‹åŠ¨é‡æ–°éƒ¨ç½²ï¼š**
```
1. Cloudflare Dashboard
2. è¿›å…¥æ‚¨çš„ Pages é¡¹ç›®
3. æ‰¾åˆ°æœ€æ–°çš„éƒ¨ç½² (Deployments)
4. ç‚¹å‡»ä¸‰ä¸ªç‚¹èœå• (...)
5. é€‰æ‹© "Retry deployment"
```

## éªŒè¯éƒ¨ç½²æˆåŠŸ

### æ£€æŸ¥ 1ï¸âƒ£: æŸ¥çœ‹æ„å»ºæ—¥å¿—

```
Cloudflare Dashboard
  â†“
Pages é¡¹ç›®
  â†“
Deployments (éƒ¨ç½²)
  â†“
ç‚¹å‡»æœ€æ–°çš„éƒ¨ç½²
  â†“
Build log (æ„å»ºæ—¥å¿—)
```

**åº”è¯¥çœ‹åˆ°ï¼š**
```
âœ… é…ç½®æ–‡ä»¶å·²ç”Ÿæˆï¼šsrc/config.js
   - AMAP_API_KEY: e5b759a2...
   - AMAP_SECURITY_JS_CODE: f93d8688...
```

### æ£€æŸ¥ 2ï¸âƒ£: æ‰“å¼€ç½‘ç«™

```
1. æ‰“å¼€æ‚¨çš„ Pages ç½‘ç«™
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. è¿›å…¥ "Console" æ ‡ç­¾
```

**åº”è¯¥çœ‹åˆ°ï¼ˆä¸åº”è¯¥çœ‹åˆ°é”™è¯¯ï¼‰ï¼š**
```
âœ… é«˜å¾·åœ°å›¾ SDK åŠ è½½æˆåŠŸ
âœ… åœ°å›¾åˆå§‹åŒ–æˆåŠŸ
âœ… åŠ è½½äº† X ä¸ªè§‚æ˜Ÿåœ°

âŒ ä¸åº”è¯¥çœ‹åˆ°ï¼š
   - process is not defined
   - CONFIG is not defined
   - AMapLoader æœªå®šä¹‰
```

### æ£€æŸ¥ 3ï¸âƒ£: åŠŸèƒ½æµ‹è¯•

- [ ] åœ°å›¾æ­£å¸¸æ˜¾ç¤º
- [ ] èƒ½çœ‹åˆ°çº¢è‰²æ ‡è®°
- [ ] ç‚¹å‡»æ ‡è®°æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
- [ ] "åˆ·æ–°æ•°æ®" æŒ‰é’®å¯ç”¨

## æ•…éšœæ’é™¤

### é—®é¢˜ï¼šæ„å»ºå‘½ä»¤ä»ä¸ºç©º

**åŸå› ï¼š** æ²¡æœ‰æ­£ç¡®ä¿å­˜è®¾ç½®

**è§£å†³ï¼š**
1. å†æ¬¡è¿›å…¥ Build and deployments
2. ç¡®ä¿ Build command å¡«å…¥ `npm run build`
3. ç‚¹å‡» [Save]ï¼ˆæœ‰äº›æµè§ˆå™¨éœ€è¦æ»šåŠ¨åˆ°åº•éƒ¨ï¼‰
4. ç­‰å¾…ä¿å­˜å®Œæˆï¼ˆåº”è¯¥çœ‹åˆ°ç¡®è®¤æç¤ºï¼‰

### é—®é¢˜ï¼šbuild-config.js æ‰¾ä¸åˆ°

**åŸå› ï¼š** æ–‡ä»¶æœªä¸Šä¼ åˆ° GitHub

**è§£å†³ï¼š**
```bash
# æœ¬åœ°æ‰§è¡Œ
git add build-config.js package.json
git commit -m "æ·»åŠ æ„å»ºè„šæœ¬"
git push origin main
# ç­‰å¾… Cloudflare Pages è‡ªåŠ¨éƒ¨ç½²
```

### é—®é¢˜ï¼šç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ

**åŸå› ï¼š** å¯èƒ½è®¾ç½®åœ¨äº† Preview ç¯å¢ƒè€Œä¸æ˜¯ Production ç¯å¢ƒ

**è§£å†³ï¼š**
1. å†æ¬¡æ£€æŸ¥ Environment variables
2. ç¡®ä¿åœ¨ "Production" æ ‡ç­¾ä¸­è®¾ç½®ï¼ˆä¸æ˜¯ Previewï¼‰
3. é‡æ–°éƒ¨ç½²

### é—®é¢˜ï¼šnode_modules é”™è¯¯

**åŸå› ï¼š** Cloudflare Pages è‡ªåŠ¨å®‰è£… npm ä¾èµ–

**è§£å†³ï¼š**
- å®Œå…¨æ­£å¸¸çš„è¡Œä¸ºï¼Œä¸éœ€è¦å¤„ç†
- å¦‚æœå‡ºç°è¶…æ—¶ï¼Œè¯·è”ç³» Cloudflare æ”¯æŒ

## æ–‡ä»¶å¯¹åº”å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¯å¢ƒå˜é‡             â”‚ (Cloudflare Dashboard ä¸­è®¾ç½®)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AMAP_API_KEY         â”‚
â”‚ AMAP_SECURITY_JS_CODEâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ npm run build        â”‚ (æ„å»ºå‘½ä»¤)
    â”‚ â†“                    â”‚
    â”‚ build-config.js      â”‚ (è„šæœ¬æ–‡ä»¶)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ src/config.js        â”‚ (ç”Ÿæˆçš„é…ç½®æ–‡ä»¶)
        â”‚ window.CONFIG = {...}â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â†“
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ index.html           â”‚
            â”‚ <script src="...">   â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ app.js               â”‚
                â”‚ CONFIG.AMAP_API_KEY  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ âœ… åœ°å›¾åŠ è½½æˆåŠŸ      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå‚è€ƒ

| æ“ä½œ | ä½ç½® | å€¼ |
|------|------|-----|
| è®¾ç½® API Key | Dashboard â†’ Settings â†’ Environment variables (Production) | `AMAP_API_KEY` = æ‚¨çš„ Key |
| è®¾ç½®å®‰å…¨å¯†é’¥ | Dashboard â†’ Settings â†’ Environment variables (Production) | `AMAP_SECURITY_JS_CODE` = æ‚¨çš„å¯†é’¥ |
| è®¾ç½®æ„å»ºå‘½ä»¤ | Dashboard â†’ Settings â†’ Build and deployments | Build command = `npm run build` |
| è§¦å‘éƒ¨ç½² | git push æˆ– Dashboard â†’ Deployments â†’ Retry |  |

## å®Œæˆåçš„æ ·å­

```
æ‚¨çš„æµè§ˆå™¨
  â†“
https://your-site.pages.dev
  â†“
index.html (åŠ è½½)
  â”œâ”€ src/config.js (å·²ä» src/ ç”Ÿæˆ) âœ…
  â”œâ”€ src/app.js (ä½¿ç”¨ CONFIG) âœ…
  â”œâ”€ src/app.css (æ ·å¼) âœ…
  â””â”€ loader.js (é«˜å¾·åœ°å›¾åŠ è½½å™¨) âœ…
       â†“
    ğŸ—ºï¸ åœ°å›¾æ˜¾ç¤º âœ…
    ğŸ“ æ ‡è®°æ˜¾ç¤º âœ…
    â„¹ï¸ ä¿¡æ¯é¢æ¿å·¥ä½œ âœ…
```
